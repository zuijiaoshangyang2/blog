---
title: ä½¿ç”¨javaè®¢é˜…mqttæœåŠ¡å™¨æ¶ˆæ¯ä»£ç 
date: 2023-10-30T18:57:42+08:00
lastmod: 2023-10-30T21:37:42+08:00
tags: 
    - â˜•JAVA
    - ğŸ¦ŸMQTT
author: yuniee
summary: ä½¿ç”¨javaè®¢é˜…mqttæœåŠ¡å™¨å‘é€çš„æ¶ˆæ¯ã€‚
image: https://s2.loli.net/2023/10/30/NlAuaLzg4VKePCn.jpg
---

# ä½¿ç”¨javaè®¢é˜…mqttæœåŠ¡å™¨å‘é€çš„æ¶ˆæ¯ã€‚

## ğŸ¦Ÿå‰æ

æœ‰ä¸€ä¸ªmqttæœåŠ¡å™¨ï¼Œå¯ä»¥è‡ªè¡Œæ­å»ºæˆ–ä½¿ç”¨å…¬å…±mqttæœåŠ¡å™¨ã€‚

ä½¿ç”¨å‰è¯·å…ˆå®‰è£…Pahoæ¨¡å—

## ğŸ‘¾ä»£ç 

```java
import org.eclipse.paho.client.mqttv3.MqttClient;
import org.eclipse.paho.client.mqttv3.MqttConnectOptions;
import org.eclipse.paho.client.mqttv3.MqttException;
import org.eclipse.paho.client.mqttv3.persist.MemoryPersistence;

public class App {
    public staticvoid main(String[] args) {

        String subTopic = "testtopic/#";   //è®¢é˜…æ¶ˆæ¯çš„ä¸»é¢˜
        String pubTopic= "testtopic/1";   //å‘å¸ƒæ¶ˆæ¯çš„ä¸»é¢˜
        String content ="æµ‹è¯•æµ‹è¯•";           //å‘å¸ƒæ¶ˆæ¯çš„å†…å®¹
        int qos = 2;                        //æœåŠ¡ç­‰çº§ï¼Œ0ï¼šæœ€å¤šä¸€æ¬¡ï¼›
                                           //        1ï¼šè‡³å°‘ä¸€æ¬¡ï¼›
                                           //        2ï¼šç¡®ä¿åªæœ‰ä¸€æ¬¡ã€‚
        String broker = "tcp://127.0.0.1"; //MQTTæœåŠ¡å™¨åœ°å€å’Œç«¯å£

        String clientId= "emqx_test";          //å®¢æˆ·ç«¯IDæ ‡å¿—ç 

        //çº¦æŸå†…å­˜æŒä¹…åŒ–
        MemoryPersistencepersistence = new MemoryPersistence();

        try {
            //å®ä¾‹åŒ–ä¸€ä¸ªå®¢æˆ·ç«¯
            MqttClient client = new MqttClient(broker, clientId, persistence);

            //è®¾ç½®MQTTè¿æ¥é€‰é¡¹
            MqttConnectOptions connOpts = new MqttConnectOptions();
            //è¿æ¥MQTTæœåŠ¡å™¨è´¦æˆ·å’Œå¯†ç 
            connOpts.setUserName("username");
            connOpts.setPassword("password".toCharArray());
            //ä¿ç•™ä¼šè¯
            connOpts.setCleanSession(true);

            //è®¾ç½®å›è°ƒï¼Œæ”¶åˆ°è®¢é˜…ä¿¡æ¯è¦æ‰§è¡Œçš„ä»»åŠ¡
            client.setCallback(new OnMessageCallback());

            //å»ºç«‹è¿æ¥
            //System.out.println("Connecting to broker: " + broker);
            client.connect(connOpts);

            //System.out.println("Connected");
           //System.out.println("Publishing message: " + content);

            //è®¢é˜…æŸä¸ªä¸»é¢˜
            client.subscribe(subTopic);

            //æ¶ˆæ¯å‘å¸ƒæ‰€éœ€å‚æ•°
            //MqttMessage message = new MqttMessage(content.getBytes());
            //message.setQos(qos);
            //å‘å¸ƒæ¶ˆæ¯ï¼ˆä¸»é¢˜å’Œæ¶ˆæ¯ä½œä¸ºå‚æ•°ï¼‰
            //client.publish(pubTopic, message);
            //System.out.println("Messagepublished");

            //è¿™é‡Œç”¨ä¸€ä¸ªæ­»å¾ªç¯ï¼Œä¿è¯ç¨‹åºå§‹ç»ˆè¿è¡Œç€ï¼Œä¸Šé¢çš„å›è°ƒå‡½æ•°æ‰èƒ½å¤Ÿä¸æ–­å¾—è·å–è®¢é˜…ä¿¡æ¯ï¼Œ
            //å¦åˆ™ç¨‹åºç»“æŸï¼Œå›è°ƒå‡½æ•°ä¹Ÿåœæ­¢ç›‘æ§è®¢é˜…ä¿¡æ¯ï¼Œå°±æ”¶ä¸åˆ°è®¢é˜…ä¿¡æ¯äº†ã€‚
            while(true){

            }
        } catch (MqttException me) {
            System.out.println("reason " + me.getReasonCode());
            System.out.println("msg " + me.getMessage());
            System.out.println("loc " + me.getLocalizedMessage());
            System.out.println("cause " + me.getCause());
            System.out.println("excep " + me);
            me.printStackTrace();
        }

    }
}


#å›è°ƒçš„æ–¹æ³•

import org.eclipse.paho.client.mqttv3.IMqttDeliveryToken;

import org.eclipse.paho.client.mqttv3.MqttCallback;

import org.eclipse.paho.client.mqttv3.MqttMessage;





//å›è°ƒç±»ç»§æ‰¿MqttCallbackç±»ï¼Œè¦†ç›–ä¸‹é¢çš„ä¸‰ä¸ªæ–¹æ³•ï¼Œpublic class OnMessageCallback implements MqttCallback {



    public void connectionLost(Throwable throwable) {

        // è¿æ¥ä¸¢å¤±åï¼Œä¸€èˆ¬åœ¨è¿™é‡Œé¢è¿›è¡Œé‡è¿

        System.out.println("è¿æ¥æ–­å¼€ï¼Œå¯ä»¥åšé‡è¿");

    }



    public void messageArrived(String s, MqttMessage mqttMessage) throws Exception {

        // subscribeåå¾—åˆ°çš„æ¶ˆæ¯ä¼šæ‰§è¡Œåˆ°è¿™é‡Œé¢

        System.out.println("æ¥æ”¶æ¶ˆæ¯ä¸»é¢˜:" + s);

        System.out.println("æ¥æ”¶æ¶ˆæ¯Qos:" + mqttMessage.getQos());

        System.out.println("æ¥æ”¶æ¶ˆæ¯å†…å®¹:" + new String(mqttMessage.getPayload()));

    }



    public void deliveryComplete(IMqttDeliveryToken iMqttDeliveryToken) {

        System.out.println("deliveryComplete---------" + iMqttDeliveryToken.isComplete());

    }

}
```

