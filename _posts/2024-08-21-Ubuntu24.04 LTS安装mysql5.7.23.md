---
title: Ubuntu24.04 LTSå®‰è£…mysql 5.7.23
permalink: /mysql5_7_23
date: 2024-08-21T18:57:42+08:00
lastmod: 2024-08-21T19:05:42+08:00
tags: 
    - ğŸ˜Linux
    - ğŸ“¦MySQL
author: yuniee
summary: Ubuntu 24.04 LTSå®‰è£…mysql 5.7.23ï¼Œè§£å†³AppArmorå¯¼è‡´æ— æ³•ä¿®æ”¹datadir
image: https://s2.loli.net/2024/08/21/X3h4SyxtrENo8I6.png
---



# Ubuntu24.04 LTSå®‰è£…mysql 5.7.23

## ğŸ”ä¸€ã€å®‰è£…ä¾èµ–

Ubuntu 24å¼€å§‹ä¸å†ä½¿ç”¨libtinfo5ï¼Œè€Œæ˜¯é»˜è®¤ä½¿ç”¨libtinfo6ï¼Œä¹Ÿæ²¡æœ‰ libaio1 å’Œ libaio-devã€‚ä½†æ˜¯5.7.23ç‰ˆæœ¬æ¯”è¾ƒæ—§ï¼Œéœ€è¦è¿™äº›æ—§ä¾èµ–ã€‚æ‰€ä»¥é¦–å…ˆå®‰è£…è¿™äº›å¿…è¦çš„ä¾èµ–ã€‚

### ğŸ«¥1.1 å®‰è£…libtinfo5

å‚è€ƒï¼š[https://blog.csdn.net/engchina/article/details/135396971](https://blog.csdn.net/Yuking004/article/details/144937295)

```bash
sudo apt update
wget http://security.ubuntu.com/ubuntu/pool/universe/n/ncurses/libtinfo5_6.3-2ubuntu0.1_amd64.deb
sudo apt install ./libtinfo5_6.3-2ubuntu0.1_amd64.deb
```

### ğŸ«1.2 å®‰è£…libaio1 å’Œ libaio-dev

å‚è€ƒï¼šhttps://blog.csdn.net/engchina/article/details/139812240

```bash
curl -O http://launchpadlibrarian.net/646633572/libaio1_0.3.113-4_amd64.deb
sudo dpkg -i libaio1_0.3.113-4_amd64.deb 
sudo apt-get install libaio-dev
```

## ğŸ¤‘äºŒã€å®‰è£…mysql 5.7.23

### ğŸ§2.1 è·å–deb-bundle

#### åˆ›å»ºç›®å½•å¹¶è¿›å…¥

```bash
mkdir -p /opt/mysql && cd /opt/mysql
```

#### ä¸‹è½½å‹ç¼©åŒ…

```bash
wget https://downloads.mysql.com/archives/get/p/23/file/mysql-server_5.7.23-1ubuntu18.04_amd64.deb-bundle.tar
```

#### è§£å‹

```bash
tar xvf ./mysql-server_5.7.23-1ubuntu18.04_amd64.deb-bundle.tar
```

#### å®‰è£…./libmysql*

```bash\
sudo apt-get install ./libmysql*
```

### ğŸº2.2 å®‰è£…å®¢æˆ·ç«¯

```bash
sudo apt-get install ./mysql-community-client_5.7.23-1ubuntu18.04_amd64.deb
sudo apt-get install ./mysql-client_5.7.23-1ubuntu18.04_amd64.deb
```

### ğŸ¥¶2.3 å®‰è£…æœåŠ¡ç«¯

```bash
sudo apt-get install ./mysql-community-server_5.7.23-1ubuntu18.04_amd64.deb
```

åœ¨è¿™ä¸ªå®‰è£…è¿‡ç¨‹ä¸­ä¼šéœ€è¦è®¾ç½®rootç”¨æˆ·çš„å¯†ç ã€‚å®‰è£…ä¹‹åç»§ç»­è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š

```bash
sudo apt-get install ./mysql-server_5.7.23-1ubuntu18.04_amd64.deb
```

æ­¤æ—¶å°±å®‰è£…å®Œæˆäº†

### ğŸ¥¸2.4 éªŒè¯å®‰è£…

è¾“å…¥`systemctl status mysql`å¯éªŒè¯ï¼š

<img src="https://s2.loli.net/2024/08/21/NGwqLZDzlmnCYau.jpg" alt="status"  />

å¦‚æœå¦‚ä¸Šå›¾ä¸€æ ·å¯ä»¥çœ‹åˆ°runningå°±è¯´æ˜è¿è¡ŒæˆåŠŸäº†ã€‚

ç„¶åå°è¯•è¿›å…¥MySQL

```bash
mysql -u root -p
```

è¾“å…¥åˆšæ‰å®‰è£…è¿‡ç¨‹ä¸­è®¾ç½®çš„å¯†ç è¿›å…¥mysqlã€‚

è¾“å…¥`SELECT VERSION();`å¯ä»¥æŸ¥çœ‹ç‰ˆæœ¬ã€‚è¯´æ˜å®‰è£…æˆåŠŸï¼Œä¸”æ­£å¸¸è¿è¡Œï¼Œä¸”ä¸ºæ­£ç¡®ç‰ˆæœ¬ã€‚

## ğŸ¥³ä¸‰ã€ä¿®æ”¹datadir

æœ‰æ—¶å€™éœ€è¦ä¿®æ”¹ä¸€ä¸ªdatadiræ¥å­˜å‚¨æ•°æ®ï¼Œæ¯”å¦‚æƒ³è¦æŒ‚è½½ä¸€ä¸ªç¡¬ç›˜æ¥ä¸“é—¨å­˜å‚¨æ•°æ®ç­‰ã€‚

é¦–å…ˆåœæ­¢mysqlè¿›ç¨‹

```bash
systemctl stop mysql
```

ç„¶åç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š

```bash
vim /etc/mysql/mysql.conf.d/mysqld.cnf
```

é…ç½®æ–‡ä»¶ä¸­æœ‰è¿™æ ·ä¸€æ®µé…ç½®ï¼š

```bash
[mysqld]
pid-file        = /var/run/mysqld/mysqld.pid
socket          = /var/run/mysqld/mysqld.sock
datadir         = /var/lib/mysql                #ä¿®æ”¹æ­¤è¡Œ
log-error       = /var/log/mysql/error.log
```

æˆ‘æƒ³è¦æŠŠæˆ‘çš„`datadir`æ”¹ä¸º`/data/mysql`,é‚£ä¹ˆéœ€è¦ä¿®æ”¹`datadir`åé¢çš„å†…å®¹

```bash
[mysqld]
pid-file        = /var/run/mysqld/mysqld.pid
socket          = /var/run/mysqld/mysqld.sock
datadir         = /data/mysql                #ä¿®æ”¹æ­¤è¡Œ
log-error       = /var/log/mysql/error.log
```

ç„¶åå°†`/var/lib/mysql`ä¸‹åŸæœ¬çš„å†…å®¹å…¨éƒ¨å¤åˆ¶åˆ°æƒ³è¦æ›´æ”¹çš„ç›®å½•`/data/mysql`ä¸‹é¢

```bash
cp -R /var/lib/mysql/*  /data/mysql/
```

ç„¶åæ›´æ”¹ç›®å½•çš„æ‰€æœ‰è€…ï¼š
```bash
chown -R mysql:mysql /data/mysql
```

ä¹‹åå°è¯•å¯åŠ¨MySQLï¼š

```bash
systemctl start mysql
```

è¿™æ ·å°±ä¿®æ”¹æˆåŠŸäº†ã€‚

## ğŸ‘½å››ã€ä¿®æ”¹ç›®å½•æ—¶é‡è§çš„é—®é¢˜

æœ‰æ—¶å€™è¿›è¡Œå¦‚ä¸Šä¿®æ”¹åï¼Œæ— è®ºå¦‚ä½•ä¹Ÿä¸èƒ½å¯åŠ¨MySQLï¼Œå¯èƒ½æ˜¯å› ä¸ºç³»ç»Ÿä¸­å®‰è£…äº†AppArmorã€‚è¿™ä¼šé™åˆ¶MySQLå¯¹ç›®å½•çš„è®¿é—®æƒé™ã€‚

### ğŸ®4.1 æ£€æŸ¥æ˜¯å¦å®‰è£…å¹¶å¼€å¯äº†AppArmor

```bash
user@30-6-database:~$ sudo aa-enabled 
Yes
```

å¦‚ä¸Šæ˜¾ç¤ºYESå³å®‰è£…å¹¶å¼€å¯äº†AppArmorã€‚

ç„¶åè¿›å…¥/etc/apparmor.d/

```bash
cd /etc/apparmor.d/
```

æŸ¥çœ‹æœ‰å…³MySQLçš„é…ç½®ï¼š

```bash
ls | grep mysql
```

å¯ä»¥çœ‹åˆ°å¦‚ä¸‹æ–‡ä»¶ï¼š

![mysql](https://s2.loli.net/2024/08/21/Wvhbt3wLqk4DHrN.jpg)

ç¼–è¾‘æ­¤æ–‡ä»¶ï¼š

```bash
sudo vim usr.sbin.mysqld
```

![mysqld](https://s2.loli.net/2024/08/21/1Cpgae6tkrnW8MK.jpg)

å¦‚ä¸Šï¼Œæ‰¾åˆ°`# Allow data dir access`ä¸€æ ï¼Œæ·»åŠ `/data/mysql/ rw,` ï¼Œèµ‹äºˆMySQLè¯»å†™æˆ‘ä»¬çš„æ–°datadirç›®å½•çš„æƒé™ã€‚

ç„¶åé‡å¯apparmorä½¿é…ç½®ç”Ÿæ•ˆï¼š

```bash
systemctl restart apparmor
```

ä¹‹åå†æ¬¡å°è¯•å¯åŠ¨MySQLã€‚è¿™æ ·å°±ä¸ä¼šæŠ¥é”™äº†ã€‚
